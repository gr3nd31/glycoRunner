# glycoRunner
Script to directly compare whole protein gels to glycosylation gels. Ideally, the length of the lane extractions between the whole protein and the glycosylated protein should be the same, but this version of the script should be able to adjust lanes of varying sizes.
Additionally, extractions should be performed using a box ROI in ImageJ. While line extractions *can* work, they are extremely sensitive to random noise in the image.
The code has additional functionality to automatically call specific protein band peaks, but this is currently disabled until someone asks for it back. It *only* correlates data and makes pretty graphs now.
Relative glycosylation score is calculated by subtracting the whole protein values from the glycosylation protein values at each pixel. and performing lower quartile normalization.

### Example of the whole protein heatmap:
https://github.com/gr3nd31/glycoRunner/edit/main/Example_relGlyco.pdf

### Example of the intensity correlation plot:
https://github.com/gr3nd31/glycoRunner/edit/main/Example_signalCorr_relGlycoScore.pdf

## How to run:

### Automated
1. The automatic function only work if the various glycoRun() parameters match the actual file names (See the **Manual** instructions for the correct default names) and the schema file is filled out correctly. While this takes a little more effort, it does make the process of pairing samples and collecting data much easier.
2. Open R and source the glycorunn.R script
3. Fill out the schema file or add new samples to the files. New, unprocessed samples should have an "N" under the `Processed` column. If you would like to pair multiple samples into a single figure, mark the `Pair` column with "Y". Otherwise, mark it with an "N".
4. Call runGlyco() script, which takes the following parameters: 
   - **directoryLocation**: The path to the parent directory containing all of your sample files. Default is the current directory ("./").
   - **graphing**: whether or not to graph "paired" samples. Default is TRUE.
   - **pairing**: Which samples are used to generate the final graphs. Default is "all" that will graph all samples independently. Any other entry will default to using the samples within the schema file that contain a "Y" under the `Pair` column.
   - **colorBy**: Which category is used to color points in the SignalCorrelation plot. Default is "Metadata" from the schema file or else the sample_id column is used.
5. First, you will be asked if you would like to scan the schema file to generate new sample directories. If any answer **except** "n" is given, then new sample directories will now get added based on new samples in the schema file
6. Secondly, you will be prompted to process the data or not. Entering in "y" will then run the analysis scripts on any sample with a "N" in the `Processed` column of the schema file, using the default filenames (Once again, see **Manual** instructions for those names).
7. This will generate a new directory called `GlycoCat`, which contains:
    - A csv called `glycoCated.csv` that contains the data from either all of the samples or just the selected samples (Using the `Pair` column in the schema file)
    - A csv called `annotated_glcyoCated.csv` that is a copy of the schema file but with additional data from the analysis including the average ratio, the median ratio, the lower quartile ratio, and the upper quartile ratio. These can then be compared graphically.
    - The various graphs normally generated by glycoRunner, but now faceted by the sample_id or the metadata


### Manual
1. Open R and source the glycorunn.R script
2. Setwd() to a directory containing the data files. Each lane or sample should have its own directory containing nothing but its specific files.
3. Call glycoRun() script, which takes the following parameters:
  - **ladderWP**: The csv file containing the whole protein ladder. Default is "ladder.wp.csv"
  - **LadderGP**: The csv file containing the glycoprotein ladder. This may be the same file as the ladderWP. Default is "ladder.gp.csv"
  - **ladderValuesWP**: An array of kilodalton sizes marked by the whole protein ladder. This list will be used to assign ladder peaks to sizes. Default is 'c(205, 150, 100, 75, 50, 37, 25, 20, 15, 10)'
  - **ladderValuesGP**: An array of kilodalton sizes marked by the whole protein ladder. This list will be used to assign ladder peaks to sizes. If the laddWP and ladderGP files are the same, this is ignored. Default is 'c(75, 25)'.
  - **wp**: The csv containing the whole protein lane extraction. This *MUST* be the same length as the ladderWP file. Default is "wp.csv"
  - **gp**: The csv containing the glycosylated protein lane extraction. This *MUST* be the same length as the ladderGP file. Default is "gp.csv"
  - **wp_background_file**: Depending on the quality of the gel or how it was imaged, it may be necessary to subtract non-specific background intensities from the whole protein lane. Therefore, you should include a control extraction csv from a nearby lane without any protein. If this file is not present, then background subtraction will not occur as this version no longer supports dynamic background adjustment.
  - **gp_background_file**: For the same reason as outlined for the wp_background_file, the gp data should also be corrected by using a control lane extraction from the gp image without any glycosylated signal.
  - **outputCSV**: The name of the output CSV.
  - **peakCSV**: The name of the CSV containing estimated peak information.
  - **givenThresholds**: When calling peaks, an intensity threshold can be given. This is an artifact of the original code that pulled protein peak data and has been left in the case that this functionality is requested again. Default is 'F'.
  - **ladderAttempts**: The script will try to find the number of peaks in the ladder data corresponding to the number of values given. If it can't, it will adjust the thresholds up or down to find the appropriate number of peaks. This parameter controls how many times this correction will be performd until it gives up. Default is '10'.
  - **upperOrLowerLadder**: If the script cannot find the appropriate number of peaks defined by the 'ladderAttempts' parameter, this parameter tells the script whether it should use the 'upper' or 'lower' part of the ladderValues array to assign peak sizes. Default is 'lower'.

4. Assuming you use the default file names, none of these paramters should need to be changed when running the script. It will generate two new directories ('csv' and 'figures') to save the generated data and figures.

## Considerations:
- While the script is fairly robust to small differences in how far the gels have run, the closer in length the whole protein and glycosylated protein extractions are, the better the alignment will be.
- The sample extraction and ladder extractions **MUST** be the same length.
- The line generated on the correlation graph is a slope of 1 with a y-intercept of the lower quartile value of the GP_values. Hypo- or hypergylcosylations should appear as distributions above or below the line.
